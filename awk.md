# awk命令行以及awk编程语言

awk是一个模式扫描以及文本处理语言
语法好像和C语言还是挺类似的。

格式

	mawk [-W 选项] [-F 值] [-v 变量=值] [--] '程序文本' [文件。。。]
	mawk [-W 选项] [-F 值] [-v 变量=值] [-f 程序文件] [--] [文件。。。]

描述
	mawk是一个AWK编程语言的解析器。The Awk语言是有用的为维护关于数据文件，文本获取和处理
	和实现原型、体验算法。

	一个AWK程序是一个序列关于<模式> {<指令>} 对和函数定义。
	短程序被键入在命令行，通常包含在单引号之间，防止shell解析。
	长一点的程序能够被读到从一个文件中，通过-f 选项。
	数据输入被读取从文件列表在命令行或者从标准输入中当文件列表为空时。

	输入被分割成<记录>，通过记录分割变量(Record Separator), RS.
	初始时，RS='\n', 记录和行同步。
	每一个记录都会和<模式>比较，如果匹配，程序文本中的{<指令>}部分就会被执行。



选项：

	-F <值>			设置域分隔符FS到到<值>

	-f <文件>		从文件中读取AWK程序文本，绕过命令行， mawk支持多个 -f 选项。

	-v <变量>=<值>		设置程序变量的值为<值>, 通过命令行设置的变量的类型为"字符和数字"

	--			标识易混淆变量的结束

	上述的是POSIX兼容的AWK选项。

	-W 是mawk自己实现相关的指令。

# AWK语言

## 程序结构
一个AWK程序，是一个<模式> {<动作>} 配对序列和用户函数。

一个模式可以是：
	BEGIN 			开始模式，在输入流打开前，会匹配一次
	END			结束模式，在输入流结束后，会匹配一次
	表达式
	表达式，表达式 		区间模式，匹配表达式1到表达式2之间的所有字符。

一个，但不是两者，关于 <模式> {<动作>} 对，可以省略。

1. 如果{<动作>}部分省略了，隐式地表示动作是{ print }.
2. 如果<模式>部分省略了，隐式地表示全部匹配。

BEGIN 和 END 模式 时，需要描述动作。

语句是以换号符或分号分隔的。**也就是说，语句如果是在独立行中的，无需在后边写分号分隔**

一组语句像动作、循环体和C语言一样用大括号包含在一个块中。
块中的最后一条语句，不需要分隔符。

空行没有意义，一个空的语句需要使用分号结束。

长语句可以使用反斜杠来实行跨行继续。
语句的可以被分隔而不需要反斜杠，在逗号、左括号、&&，||， 在右括号之后 关于do， else， if，while， for语句，或是函数定义的右括号之后。

下面是awk的控制语句：

	if (表达式) 语句
	
	if (表达式) 语句 else 语句

	while (表达式) 语句

	do 语句 while (表达式)_

	for (可选表达式; 可选表达式; 可选表达式) 语句

	for (变量 in 数组) 语句

	continue

	break


## 数据类型、转换和比较

这里有两种基础的数据类型，数值和字符串。
数值常量可以是整数，像-2， 小数像1.08，或者科学计数法像 -1.1e4 or .28E-3。
所有的数在内部会被从新表现为浮点数。
例如：
	表达式 0.2e2 == 20  为真


字符串常量是包含在双引号中。

	"This is a string with a newline at the end.\n"

字符串跨行继续通过反斜杠转义换行符。以下是识别的转义序列。



	\\	\
	\"	"
	\a	alert 告警符 ascii 7
	\b	backspace 退格符 ascii 8
	\t	tab 制表符， ascii 9
	\n	newline 新行符，ascii 10
	\v	vertical tab 垂直制表符 ascii 11
	\f 	formfeed, ascii 12
	\r	carriage return 回车符，ascii 13
	\ddd	asciii ddd对应的1,2或3个八进制数字
	\xhh	ascii hh对应的或2个16进制数字

如果你尝试转移其他字符，mawk会忽略它，例如\c, 你会得到\c。。。。等等。


其实还有一种第三种数据类型： “数值和字符串”，它可以同时拥有数值和字符串值。
用户定义变量变得存在当第一次被引用并被初始化为null，一个“数值和字符串类型值”同时拥有数值0和字符串值“”。

非平凡"数和字符串值"来自输入并且通常被保存在域中。

表达式的类型被确定，在他的上下文中，并自动进行类型转换如果需要。
例如：

	y = x + 2; z = x "hello"

	y中的值会是数值类型。
	如果x不是数值类型，从x中读到的值换先转换为数值，在它加2存储到y之前。

	z中存储的值是字符串，x在使用前被转换为字符串然后和“hello”连接在一起。

	一个字符串表达式转换成数值的方法是使用它的最长数值前缀和atof函数一起使用。

	一个数值表达式转换成字符串的方式是使用sprintf(CONVFMT, 表达式),
	除非表达式能在主机中能被表示为一个明确的整数，然后它才会转换成sprintf("%d", 表达式）。

	CONVFMT是一个内置变量，用于数值到字符串的内部转换，初始值为“%.6g”.
	显式的类型转换可以被强制， expr "" 是字符串， expr + 0 是数值。

	expr1 比较操作符 expr2，如果两边是数值或“数值字符串”类型，则按数值方式比较。
	如果一边操作数为字符串，则非字符串操作数会被转换成字符串。
	比较的结果为数值，1或0。

## 正则表达式
在AWK语言中，记录、域和字符串经常被测试是否匹配一个正则表达式。

正则表达式被包含在斜杠中，下面是一个AWK表达式。

	表达式 ~ /正则表达式/

波浪符号相当于“匹配”的意思。两个斜杠包含的部分为需要匹配的正则表达模式。
如果匹配成功，表达式返回1，如果匹配不成功，表达式返回0。

	!~ 为“不匹配”的意思。

在模式，行动对中，也可以使用正则匹配表达式：

	/正则表达式/ {行动}	和 $0 ~ /正则表达式/ {行动}

	
/正则表达式/ 是一个简化的AWK匹配表达式， 省略了输入部分$0和连接符。 $0 在AWK中表示整个记录。$1,$2.....表示记录的域。

AWK匹配表达式是由两部分组成的第一部分是输入的需要进行匹配处理的对象，第二部分是需要匹配的正则表达式。
输入和正则之间用波浪号分隔，表示两边有关系。正则用斜杠包含在一起。


AWK 使用 扩展的正则表达式，就像在 grep 加 -E的中用的一样。

下面的符号在正则表达式中是有特殊意义的：

	\ ^ . [] | () * + ?

	
## 表达式和操作符

	赋值 		= += -= *= /= %= ^=
	条件		? :
	逻辑或		||
	逻辑与		&&
	数组成员关系	in
	匹配		~ !~
	关系		< > <= >= == !=
	加相关操作符	+ -
	乘相关操作符	* / %
	单运算符	+ -
	逻辑否		!
	次幂		^
	递增，递减	++ --
	域		$

## 数组

	for (变量 in 数组) 语句

## 内部变量

	RS	record separator 记录分隔符 可是是正则表达式形式的，但是还是用双引号圈起，不用斜杠包含。
	FS	field separator  字段分隔符
	ORS	output record separator 输出字段分隔符
	NF	number of fields in current record 当前记录
	


## 内部函数
	
	gsub(r, s, t)	gsub(r,s)
		gsub 是全局替换的缩写global substitution
		r 是要匹配的正则表达式，同样要用斜杠来包起来
		s 是要执行替换的字符串
		t 是要替换匹配字符串的文本

## 输入输出


## 用户定义函数

## 字符串分隔，记录和文件

## 多行记录

因为mawk将记录分隔符RS当成普通的表达式，因此多行记录是容易的。
把RS设置成"\n\n+"，使用多个空白行来分隔记录。
很有意思的是RS看上去是一个正则表达式。


## 程序执行









	

